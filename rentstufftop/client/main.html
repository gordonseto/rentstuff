<template name="ApplicationLayout">
<head>
  <title>Rent stuff</title>
</head>
<div class="hometitle">
<a href="{{pathFor route='home'}}">
<h1>Rent stuff</h1>
</a>
</div>
{{> navigation}}
  {{> yield}}
</template>

<template name="navigation" class="navigation">
  <a href="{{pathFor route='newPosting'}}">New Posting</a>
  {{#if currentUser}}
  <a href="/profile/{{loggedinUser}}">{{loggedinUser}}</a>
  <a href="#" class="logout">Logout</a>
  {{else}}
  <a href="{{pathFor route='login'}}">Login</a>
  <a href="{{pathFor route='register'}}">Register</a>
  {{/if}}
</template>

<template name="home">
<p> {{> filter}} </p>
</template>

<template name="map">
{{test}}
<div class="map-container">
  {{> googleMap name="map" options=mapOptions}}
</div>
</template>

<template name="filter">
  <form>
  <p>Searching near <input id="location" type="text" placeholder="City" value="{{city}}"/></p>
  <p><input type="button" id="filterstoggle" class="filterstoggle" value="Filters"><input type="button" class="maptoggle" value="Map"></p>
    <div class="filters-container">
      <table id="filters_table">
      <thead>
      <tr>
        <th scope="col">CATEGORIES</th>
      </tr>
      </thead>
      <tbody>
      <tr>
        <td>SNOW</td>
      </tr>
      <tr>
        <td>WATER</td>
      </tr>
      <tr>
        <td>SPORT</td>
      </tr>
      <tr>
        <td>UTILITY</td>
      </tr>
      </tbody>
      </table>
    </div>
    <div class="map-container">
      {{> googleMap name="map" options=mapOptions}}
    </div>
  </form>
  <div>
    {{#each results}}
    <div class="posting_container">
    <a href="{{pathFor route='posting'}}" target="{{pathFor route='posting'}}">
    <span class="postPreview">
    <p><img src="{{postingImages.[0]}}"></p>
    <p>{{title}}</p>
    <p>Location: {{location}}</p>
    <p>{{rentalrate}} /day</p>
    <p>Posted {{timedifference}}</p>
    {{posting_marker}}
    </span>
    </a>
    </div>
    {{/each}}
  </div>
</template>

<template name="searchbox">
<p>{{> map}}</p>
<form>
  <input type="text" id="search-box">
</form>
{{#if getPostings}}
{{#each getPostings}}
    <a href="{{pathFor route='posting'}}">
    <span class="postPreview">
    <p><img src="{{postingImages.[0]}}"></p>
    <p>{{{title}}}</p>
    <p>Location: {{{location}}}</p>
    <p>{{{rentalrate}}} /day</p>
    <p>Posted {{{timedifference}}}</p>
    </span>
    </a>
{{/each}}
{{else}}
{{> displayPostings}}
{{/if}}
</template>

<template name="imageupload">
  <form id="postingimages">
    <input type="file" id="postingimage1" name="userimage1"/>
    <input type="file" id="postingimage2" name="userimage2"/>
    <button type="submit" class="submitimages">Upload</button>
  </form>
  <div class="image_holder">
  </div>
</template>

<template name="displayPostings">
  {{#each posting}}
    <a href="{{pathFor route='posting'}}">
    <span class="postPreview">
    <p><img src="{{postingImages.[0]}}"></p>
    <p>{{title}}</p>
    <p>Location: {{location}}</p>
    <p>{{rentalrate}} /day</p>
    <p>Posted {{timedifference}}</p>
    </span>
    </a>
  {{/each}}
</template>

<template name="newPosting">
  <form>
  {{location_search}}
  <p>Title: <input type="text" name="title" required></p>
  <p>Description: <input type="text" name="description"></p>
  <p>Location: <input type="text" name="location" required></p>
  <p>Address: <input type="text" name="address" required></p>
  <p>Rental rate: <input type="text" name="rentalrate" required> /day</p>
  <p>Category: <input type="text" name="category"> </p>
    <div class="row">
      <div class="col-xs-5">
        <div class="form-group">
          <div id="datepicker"></div>
        </div>
      </div>
      <div class="col-xs-6">
      <br><br><br>
      <p><input type="checkbox" id="all-dates" value="All dates"> All Dates</p>
      <p><input type="checkbox" id="1" value="All dates"> All Dates</p>
      <p><input type="checkbox" id="2" value="All dates"> All Dates</p>
      <p><input type="checkbox" id="3" value="All dates"> All Dates</p>
      </div>
    </div>
  <p>{{> imageupload}}</p>
  <p><input type="submit" value="Post"></p>
  </form>
</template>

<template name="posting_map">
<div class="posting-map-container">
  {{> googleMap name="map" options=mapOptions}}
</div>
</template>

<template name="posting">
  <p>Title: {{title}}</p>
  <p>Posted by: <a href="{{pathFor route='profile'}}">{{createdBy}}</a></p>
  <p>Description: {{description}}</p>
  <p>Location: {{location}}</p>
  <p>Address: {{address}}</p>
  <p>Rental rate: {{rentalrate}} /day</p>
  <p>Posted {{timedifference}}</p>
  <p> {{#each postingImages}}
          <p><img src="{{this}}"></p>
      {{/each}}</p>
    {{> calendar}}
  {{#if geocode_address}}
  {{> posting_map}}
  {{/if}}
  {{#if isOwner}}
    <p><a href="{{pathFor route='edit'}}">Edit Posting</a></p>
    <p><a class='bump'>Bump Posting</a></p>
  {{/if}}
  {{#if posting_is_saved}}
    <p><a class="posting-saved">Posting Saved</a></p>
  {{else}}  
    <p><a class="save-posting">Save Posting</a></p>
  {{/if}}
</template>

<template name="edit">
  <form>
  <p>Title: <input type="text" name="title" value="{{title}}" required></p>
  <p>Description: <input type="text" name="description" value="{{description}}"></p>
  <p>Location: <input type="text" name="location" value="{{location}}" required></p>
  <p>Address: <input type="text" name="address" value="{{address}}"></p>
  <p>Rental rate: <input type="text" name="rentalrate" value="{{rentalrate}}" required> /day</p>
  <p>Category: <input type="text" name="category" value="{{category}}" required> /day</p>
  <p> {{#each postingImages}}
          <p><img src="{{this}}"><a href='#' class="delete-image">[delete]</a></p>
      {{/each}}</p>
  <p>{{> imageupload}}</p>
  <p><input type="submit" value="Save"></p>
  </form>
</template>

<template name="calendar">
  <form id="book-date">
    <div class="row">
      <div class="col-xs-5">
        <div class="form-group">
          <div id="datepicker"></div>
        </div>
      <p><em>Equipment can only be booked up to one year ahead.</em></p>
      </div>
      <div class="col-xs-4">
        <div class="form-group">
          <button class="btn btn-success btn-block">Book</button>
        </div>
      </div>
    </div>
  </form>
{{blockDates}}
</template>

<template name="confirm">
<p>You have selected to rent <strong>{{#with posting}}<a href="{{pathFor route='posting'}}">{{title}}</a>{{/with}}</strong> for {{daysBooked}}.</p>
<form>
    <div class="col-xs-4">
      <div class="form-group">
        <button class="btn btn-success btn-block">Confirm Booking</button>
      </div>
  </div>
</form>
</template>

<template name="profile">
<p><h1>{{username}}:</h1></p>
{{#if isOwner}}
  {{> profile_loans}}
  {{> profile_bookings}}
{{/if}}
<p><h2>{{#if isOwner}}My {{/if}}Postings:</h2></p>
<div class="row">
  {{#each posting}}
    <a href="{{pathFor route='posting'}}">
    <span class="postPreview">
    <p><img src="{{postingImages.[0]}}"></p>
    <p>{{title}}</p>
    <p>Location: {{location}}</p>
    <p>{{rentalrate}} /day</p>
    <p>Posted {{timedifference}}</p>
    </span>
    </a>
  {{/each}}
</div>
{{#if isOwner}}
{{> profile_saved_postings}}
{{/if}}
</template>

<template name="profile_loans">
{{#if loans}}
<h2>My upcoming loans:</h2>
{{#each loans}}
<div class='row'>
<div class='col-xs-3'>
<p>{{loans_preview_days}}:</p>
  <a href="/profile/{{username}}">{{username}}</a> renting
  {{#with loans_preview}}
      <a href="{{pathFor route='posting'}}">
        <span class="postPreview">
          <p><img src="{{postingImages.[0]}}"></p>
          <p>{{title}}</p>
          <p>Location: {{location}}</p>
          <p>{{rentalrate}} /day</p>
          <p>Posted {{timedifference}}</p>
        </span>
      </a>
  {{/with}}
</div>
</div>
{{/each}}
{{/if}}
</template>

<template name="profile_bookings">
{{#if bookings}}
<h2>My recent bookings:</h2>
{{#each bookings}}
<div class='row'>
<div class='col-xs-3'>
  {{bookings_preview_days}}:
  {{#with bookings_preview}}
      <a href="{{pathFor route='posting'}}">
        <span class="postPreview">
          <p><img src="{{postingImages.[0]}}"></p>
          <p>{{title}}</p>
          <p>Location: {{location}}</p>
          <p>{{rentalrate}} /day</p>
          <p>Posted {{timedifference}}</p>
        </span>
      </a>
  {{/with}}
</div>
</div>
{{/each}}
{{/if}}
</template>

<template name ="profile_saved_postings">
{{#if saved_postings}}
<p><h2>Saved postings:</h2></p>
<div class="row">
{{#each saved_postings}}
    {{#with saved_postings_preview}}
      <a href="{{pathFor route='posting'}}">
        <span class="postPreview">
          <p><img src="{{postingImages.[0]}}"></p>
          <p>{{title}}</p>
          <p>Location: {{location}}</p>
          <p>{{rentalrate}} /day</p>
          <p>Posted {{timedifference}}</p>
        </span>
      </a>
    {{/with}}
  {{/each}}
</div>
{{/if}}
</template>

<template name="register">
  <h2>Register</h2>
  <form class="register">
  <p>Email: <input type="email" name="email" required></p>
  <p>Username: <input type="username" name="username" required></p>
  <p>Password: <input type="password" name="password" required></p>
  <p><input type="submit" value="Register"></p>
  </form>
</template>

<template name="login">
{{checkIfLoggedIn}}
  <h2>Login</h2>
  <p>If you don't have an account we will create one for you automatically.</p>
  <form class="login">
    <p>Email: <input type="email" name="email" required></p>
    <p>Password: <input type="password" name="password" required></p>
    <p><input type="submit" value="Login"></p>
  </form>
</template>

<template name="account">
  <h2>My Account</h2>
  <h3>My Postings:</h3>
  {{> accountPostings}}
</template>

<template name="accountPostings">
  {{#each posting}}
    <a href="{{pathFor route='posting'}}">
    <span class="postPreview">
      <p>{{#with postingImages}}
          <img src="{{imageId.[0]}}">
          {{/with}}
      </p>
    <p>{{title}}</p>
    <p>Location: {{location}}</p>
    <p>{{rentalrate}} /day</p>
    </span>
    </a>
{{/each}}
</template>

<template name="success">
  <p><h2>Booking successful!</h2></p>
</template>